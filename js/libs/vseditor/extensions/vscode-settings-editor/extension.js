"use strict";var ue=Object.create;var g=Object.defineProperty;var me=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var le=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty;var s=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),fe=(t,e)=>{for(var o in e)g(t,o,{get:e[o],enumerable:!0})},B=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ve(e))!ge.call(t,i)&&i!==o&&g(t,i,{get:()=>e[i],enumerable:!(r=me(e,i))||r.enumerable});return t};var a=(t,e,o)=>(o=t!=null?ue(le(t)):{},B(e||!t||!t.__esModule?g(o,"default",{value:t,enumerable:!0}):o,t)),he=t=>B(g({},"__esModule",{value:!0}),t);var M=s((w,q)=>{w=function(t){var e=t.match(xe);return{dir:e[1],name:e[2],ext:e[3]}};var xe=/^([\s\S]*?)((?:\.{1,2}|[^\\/]+?|)(\.[^./\\]*|))(?:[\\/]*)$/;q.exports=w});var N=s((T,F)=>{T=function(t,e){var o=t.length-e.length;return o>=0&&t.indexOf(e,o)===o};F.exports=T});var z=s((b,V)=>{b=function(t,e,o){e==null&&(e=t,t=0);var r=Math.random();return o||t%1||e%1?Math.min(t+r*(e-t+parseFloat("1e-"+((r+"").length-1))),e):t+Math.floor(r*(e-t+1))};V.exports=b});var J=s((S,Y)=>{S=typeof window=="object"&&typeof document=="object"&&document.nodeType===9;Y.exports=S});var P=s((C,K)=>{var we=Object.prototype.toString;C=function(t){return we.call(t)};K.exports=C});var X=s((E,Q)=>{var Te=P();E=typeof process<"u"&&Te(process)==="[object process]";Q.exports=E});var Z=s((exports,module)=>{var random=z(),isBrowser=J(),isNode=X();exports=function(t){for(var e=new Uint8Array(t),o=0;o<t;o++)e[o]=random(0,255);return e};var crypto;isBrowser?(crypto=window.crypto||window.msCrypto,crypto&&(exports=function(t){var e=new Uint8Array(t);return crypto.getRandomValues(e),e})):isNode&&(crypto=eval("require")("crypto"),exports=function(t){return crypto.randomBytes(t)});module.exports=exports});var ee=s((D,_)=>{var be=Z(),Se="ModuleSymbhasOwnPr-0123456789ABCDEFGHIJKLNQRTUVWXYZ_cfgijkpqtvxz";D=function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:21,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Se,o="",r=e.length,i=be(21);0<t--;)o+=e[i[t]%r];return o};_.exports=D});var oe=s((j,te)=>{j=function(t){return t==null?"":t.toString()};te.exports=j});var ne=s((U,re)=>{var Ce=oe();U=function(t){return Ce(t).toLocaleLowerCase()};re.exports=U});var je={};fe(je,{activate:()=>Ee,deactivate:()=>De});module.exports=he(je);var u=a(require("vscode"));var R=a(M()),c=a(require("vscode")),H=a(N()),$=a(require("path"));function p(t,e){c.commands.executeCommand("setContext",t,e)}var A;function m(t){A=t}function ye(){return A}var I;function G(t){I=t}function L(){return I}function v(t){let e;try{e=(c.window.tabGroups.activeTabGroup.activeTab?.input).uri}catch{let r=ye();r&&(e=r.uri)}e&&c.commands.executeCommand("vscode.openWith",e,t)}async function f(t){let e=t.fileName,{name:o,dir:r}=(0,R.default)(e);switch(o){case"app.json":case"project.config.json":case"project.private.config.json":case"project.miniapp.json":return"miniprogram"}if((0,H.default)(o,".json")){let i=$.default.resolve(r,o.replace(".json",".wxml")),x=c.Uri.file(i);try{return await c.workspace.fs.stat(x),"miniprogram"}catch{}}return""}var n=a(require("vscode")),ie=a(ee()),se=a(ne());var h=class{constructor(e){this.context=e}static register(e){let o=new h(e);return n.window.registerCustomEditorProvider(h.viewType,o)}async resolveCustomTextEditor(e,o,r){o.webview.options={enableScripts:!0},o.webview.html=this.getHtmlForWebview(o.webview),o.onDidChangeViewState(()=>{o.active&&m(e),this.updateOpenSourceButton(o.active)}),m(e),this.updateOpenSourceButton(!0);let i=async()=>{o.webview.postMessage({type:"update",fileName:e.fileName,text:e.getText(),handler:await f(e)})},x=n.workspace.onDidChangeTextDocument(d=>{d.document.uri.toString()===e.uri.toString()&&i()});o.onDidDispose(()=>{x.dispose(),this.updateOpenSourceButton(!1)}),o.webview.onDidReceiveMessage(async d=>{let W="";if(d.type==="command"){let{id:ae,command:de,data:pe}=d;switch(de){case"showOpenDialog":let O=await n.window.showOpenDialog(pe);O&&(W=O[0].fsPath);break}o.webview.postMessage({type:"commandCallback",id:ae,result:W});return}switch(d.type){case"update":this.updateTextDocument(e,d.text);break;case"run":this.runCommand(d.command);break;case"editSource":v("default");break}});let y=L(),k=2;y&&(k=this.getSpace(y)),o.webview.postMessage({type:"init",space:k,language:(0,se.default)(n.env.language)}),i()}getSpace(e){let o=e.options;return o.insertSpaces?o.tabSize||2:"	"}updateOpenSourceButton(e){p("settingsEditor.openSource",e)}async updateTextDocument(e,o){let r=new n.WorkspaceEdit;r.replace(e.uri,new n.Range(0,0,e.lineCount,0),o),await n.workspace.applyEdit(r),e.save()}runCommand(e){this.getTerminal().sendText(e),n.window.setStatusBarMessage(n.l10n.t("Running command {command} in terminal settings editor",{command:e}),3e3)}getTerminal(){let e=n.window.terminals;for(let o=0,r=e.length;o<r;o++){let i=e[o];if(i.name==="settings editor")return i}return n.window.createTerminal("settings editor")}getHtmlForWebview(e){let o=e.asWebviewUri(n.Uri.joinPath(this.context.extensionUri,"editor.css")),r=e.asWebviewUri(n.Uri.joinPath(this.context.extensionUri,"editor.js")),i=(0,ie.default)();return`
      <!DOCTYPE html>
      <html lang="en">
      <head>
        <meta charset="UTF-8">
        <!--
          Use a content security policy to only allow loading images from https or from our extension directory,
          and only allow scripts that have a specific nonce.
        -->
        <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource}; script-src 'nonce-${i}'; img-src data:;">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="${o}" rel="stylesheet">
        <title>Settings Editor</title>
      </head>
      <body>
        <div id="search">
          <div class="input-container">
            <input types="text"/>
          </div>
        </div>
        <div id="container">
          <div id="toc-container"></div>
          <div id="settings-container"></div>
        </div>
        <script nonce="${i}" src="${r}"></script>
      </body>
      </html>
    `}},l=h;l.viewType="settingsEditor.settingsedit";function Ee(t){let e=u.commands.registerCommand("settingsEditor.openEditor",()=>v("settingsEditor.settingsedit")),o=u.commands.registerCommand("settingsEditor.openSource",()=>v("default"));t.subscriptions.push(e),t.subscriptions.push(o),t.subscriptions.push(l.register(t))}function De(){}u.window.onDidChangeActiveTextEditor(ce);async function ce(t){let e="settingsEditor.openEditor";if(t){G(t);let o=t.document;await f(o)?(m(o),p(e,!0)):p(e,!1)}else p(e,!1)}ce(u.window.activeTextEditor);0&&(module.exports={activate,deactivate});

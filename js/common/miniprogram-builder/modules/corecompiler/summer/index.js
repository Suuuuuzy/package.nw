!function(require, directRequire){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.compile=void 0;const common_1=require("../original/compile/common"),progressRecorder_1=require("../../../utils/progressRecorder"),summer_1=require("./summer");function getSummerOptions(e,i){const r=new Set;return r.add("javascript"),e&&(r.add(["es6module",{disableUseStrict:e.disableUseStrict}]),(e.es7||e.es6)&&r.add(["enhance",{disableUseStrict:e.disableUseStrict}]),(e.minifyWXSS||e.autoPrefixWXSS)&&r.add("wxss"),e.minifyWXML&&r.add("minifywxml"),e.minify&&(r.add("terser"),r.add("wxss"))),i&&i.forEach(e=>{if("string"==typeof e)r.add(e);else{if(!Array.isArray(e))throw new Error("invalid useSummerCompiler options: "+JSON.stringify(e));if("string"!=typeof e[0]||void 0===e[1])throw new Error("invalid useSummerCompiler options: "+JSON.stringify(e));r.add(e)}}),Array.from(r)}async function compile(e,i,r,s){var o;const t=await e.serialize(),n=Object.assign(Object.assign({},t),{compileType:e.type,summerPlugins:getSummerOptions(r.setting,s),babelSetting:null===(o=null==i?void 0:i.setting)||void 0===o?void 0:o.babelSetting});n.files=n.files.filter(common_1.isNotIgnoredByProjectConfig.bind(null,i,e.miniprogramRoot));const m=new summer_1.SummerCompiler(e,"",n),a=new progressRecorder_1.Recorder((e,i,s)=>{var o;null===(o=r.onProgressUpdate)||void 0===o||o.call(r,{id:e.toString(),message:s,status:i})});return await m.compile({},a)}exports.compile=compile;
}(require("licia/lazyImport")(require), require)
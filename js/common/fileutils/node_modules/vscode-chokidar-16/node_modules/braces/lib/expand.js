"use strict";const fill=require("fill-range"),stringify=require("./stringify"),utils=require("./utils"),append=(e="",t="",r=!1)=>{let n=[];if(e=[].concat(e),!(t=[].concat(t)).length)return e;if(!e.length)return r?utils.flatten(t).map((e=>`{${e}}`)):t;for(let p of e)if(Array.isArray(p))for(let e of p)n.push(append(e,t,r));else for(let e of t)!0===r&&"string"==typeof e&&(e=`{${e}}`),n.push(Array.isArray(e)?append(p,e,r):p+e);return utils.flatten(n)},expand=(e,t={})=>{let r=void 0===t.rangeLimit?1e3:t.rangeLimit,n=(e,p={})=>{e.queue=[];let i=p,a=p.queue;for(;"brace"!==i.type&&"root"!==i.type&&i.parent;)i=i.parent,a=i.queue;if(e.invalid||e.dollar)return void a.push(append(a.pop(),stringify(e,t)));if("brace"===e.type&&!0!==e.invalid&&2===e.nodes.length)return void a.push(append(a.pop(),["{}"]));if(e.nodes&&e.ranges>0){let n=utils.reduce(e.nodes);if(utils.exceedsLimit(...n,t.step,r))throw new RangeError("expanded array length exceeds range limit. Use options.rangeLimit to increase or disable the limit.");let p=fill(...n,t);return 0===p.length&&(p=stringify(e,t)),a.push(append(a.pop(),p)),void(e.nodes=[])}let l=utils.encloseBrace(e),o=e.queue,s=e;for(;"brace"!==s.type&&"root"!==s.type&&s.parent;)s=s.parent,o=s.queue;for(let t=0;t<e.nodes.length;t++){let r=e.nodes[t];"comma"!==r.type||"brace"!==e.type?"close"!==r.type?r.value&&"open"!==r.type?o.push(append(o.pop(),r.value)):r.nodes&&n(r,e):a.push(append(a.pop(),o,l)):(1===t&&o.push(""),o.push(""))}return o};return utils.flatten(n(e))};module.exports=expand;